# Research: 親ユーザーログイン機能

## Open Questions (From Spec / Technical Context)
1. セッション有効期間: (解決) 明示的ログアウトまたは資格情報無効化まで継続。
2. パスワード表示切替提供有無: モバイル一般的には提供。リスク: のぞき見。対策: デフォルト非表示 + 一時表示ボタン (長押し)。
3. (削除) 監査ログ保持期間: 本機能では永続監査ログを扱わないため検討不要。
4. パスワード最小長: Firebase デフォルトは 6 文字以上。要件上強度要否? 初期: デフォルト (>=6)。
5. ネットワーク不安定時リトライ: 自動再試行回数 0 (ユーザー手動) or 1 (軽度)。初期: UI再試行ボタンのみ。

## Findings
### セッション期間 (決定)
明示ログアウト / 資格失効まで継続。追加時間上限なし。

### パスワード表示切替
実装方向（トグル）をTentative。肩越し盗み見リスクは短時間表示+デフォルト非表示で軽減。

### バリデーション
Email: 簡易正規表現 + Firebase側エラー。Password: >=6文字, 非空。

### リスク/対策
| リスク                     | 影響                                         | 対策                                              |
| -------------------------- | -------------------------------------------- | ------------------------------------------------- |
| 過剰ログ保持               | （監査ログ機能対象外のため影響最小）         | N/A                                               |
| 漏洩時パスワード推測       | 不可逆ハッシュ化されているが UI 表示で覗き見 | デフォルトマスク + ワンタップトグル               |
| オフライン誤操作           | エラーメッセージ不明瞭                       | ネットワーク未接続時 明示メッセージ               |
| 無限リトライによる辞書攻撃 | ブルートフォース                             | 失敗回数メトリクス蓄積 (ロックアウトはスコープ外) |

## Decisions (Draft)
| 項目               | 選択                        | ステータス |
| ------------------ | --------------------------- | ---------- |
| セッション期間     | 明示ログアウト/資格失効まで | Decided    |
| パスワード表示切替 | 実装する (トグル)           | Tentative  |
| 失敗時メール保存   | 平文は避けハッシュ(sha256)  | Tentative  |

## Alternatives Considered
| 項目                   | 代替案             | 理由 (却下)                 |
| ---------------------- | ------------------ | --------------------------- |
| セッション30日強制更新 | 毎月ReAuth         | UX悪化 / 低必要性           |
| パスワード再入力強制   | 失敗後毎回空にする | 利便性低下 / スコープ外脅威 |
| 監査ログ無期限保持     | 分析容易           | コスト/プライバシー負荷     |
| 失敗ログメール平文     | 容易               | 個人データ露出リスク        |

## Next Clarifications Needed
- パスワード表示切替最終可否のみ

(Phase 0 END)
